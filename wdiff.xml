<?xml version="1.0"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd" [
  <!ENTITY tex "TeX">
  <!ENTITY latex "LaTeX">
]>
<book id="wdiff.xml" lang="en">
<title>A word difference finder (and others)</title>
<!-- %**end of header -->



<bookinfo><legalnotice><para>Этот файл документирует команду <command>wdiff</command>, которая сравнивает два
файла и определяет, какие слова были удалены или добавлены в первый для
получения второго.
Он также документирует некоторые другие инструменты, связанные с
<command>diff</command>.
</para>
<para>Copyright &#169; 1992, 1994, 1997, 1998, 1999, 2010, 2011, 2012, 2013
Free Software Foundation, Inc.
</para>
<para>Разрешается изготовление и распространение дословных копий данного
руководства при условии, что уведомление об авторских правах и это
уведомление о разрешении сохраняются на всех копиях.
</para>
<para>Разрешается копировать и распространять модифицированные версии этого
руководства на условиях дословного копирования, при условии, что вся
полученная производная работа распространяется на условиях уведомления о
разрешении, идентичного настоящему.
</para>
<para>Разрешается копировать и распространять переводы этого руководства на другой
язык при указанных выше условиях для измененных версий, за исключением того,
что это уведомление о разрешении может быть указано в переводе, одобренном
Фондом.
</para></legalnotice></bookinfo>

<para>Этот файл документирует команду <command>wdiff</command>, которая сравнивает два
файла и определяет, какие слова были удалены или добавлены в первый для
получения второго.
Он также документирует некоторые другие инструменты, связанные с
<command>diff</command>.
</para>
<para>Copyright &#169; 1992, 1994, 1997, 1998, 1999, 2010, 2011, 2012, 2013
Free Software Foundation, Inc.
</para>
<para>Разрешается изготовление и распространение дословных копий данного
руководства при условии, что уведомление об авторских правах и это
уведомление о разрешении сохраняются на всех копиях.
</para>
<para>Разрешается копировать и распространять модифицированные версии этого
руководства на условиях дословного копирования, при условии, что вся
полученная производная работа распространяется на условиях уведомления о
разрешении, идентичного настоящему.
</para>
<para>Разрешается копировать и распространять переводы этого руководства на другой
язык при указанных выше условиях для измененных версий, за исключением того,
что это уведомление о разрешении может быть указано в переводе, одобренном
Фондом.
</para>
<!-- ============================================================= -->
<chapter label="" id="Top">
<title>GNU wdiff</title>
<!-- ============================================================= -->

<para>Эти info-страницы документируют <command>wdiff</command>, средство поиска различий
слов, а также некоторые другие инструменты, связанные с <command>diff</command>.
Обратите внимание, что некоторые задокументированные здесь инструменты
считаются экспериментальными и могут не входить в состав каждой установки
<command>wdiff</command>.
See <link linkend="Experimental">Experimental</link>.
</para>
<para>Документация для версии 1.2.2.
</para>



<!-- ============================================================= -->
</chapter>
<chapter label="1" id="_041e_0431_0437_043e_0440">
<title>Обзор</title>
<!-- ============================================================= -->

<para><command>wdiff</command> — это интерфейс к <command>diff</command> для пословного сравнения
файлов. Он работает путем создания двух временных файлов, содержащих по
одному слову в строке, а затем выполняет команду <command>diff</command> для этих
файлов. Он собирает выходные данные <command>diff</command> и использует их для более
удобного отображения различий в словах в исходных файлах.
</para>

<para><command>mdiff</command> проходит по одному или нескольком входным файлам и
обнаруживает блоки элементов, которые повторяются более чем в одном месте.
Элементы могут быть строками, словами или объектами, определенными
пользователем.  В режиме пословного сравнения <command>mdiff</command> сравнивает два
файла, находя, какие слова были удалены или добавлены в первый файл для
получения второго, что бывает полезно, когда тексты отличаются всего на
несколько слов и были были добавлены абзацы.  Программа имеет множество
форматов вывода и хорошо взаимодействует с терминалами и пейджерами
(особенно с <command>less</command>).
</para>
<para><command>unify</command> может преобразовывать различия в формат unidiff или
наоборот.  Некоторые люди предпочитают один формат и недолюбливают другой,
но это религиозный вопрос.  Эта программа возвращает мир на Землю.
</para>
<para><command>wdiff2</command> предназначен для замены <command>wdiff</command>.  Он нацелен на
поддержку того же набора параметров, но использует <command>mdiff</command> вместо
<command>diff</command> в качестве своего бэкенда.
</para>
<para><command>wdiff</command>, <command>mdiff</command> и <command>wdiff2</command> были написаны Франсуа
Пинаром, а <command>unify</command> — Уэйном Дэвисоном.
Пожалуйста, сообщайте об ошибках по адресу <email>wdiff-bugs@gnu.org</email>.
Укажите номер версии. Для ее получения запустите программу с параметром
<option>--version</option>.  Пожалуйста, включите в свое сообщение достаточно данных
для воспроизведения результата, того результат, который вы ожидали, а также
подробные объяснения характера проблемы.
</para>
<!-- ============================================================= -->
</chapter>
<chapter label="2" id="wdiff">
<title>Средство поиска разницы слов</title>
<!-- ============================================================= -->

<para>На самом деле есть две программы для пословного сравнения файлов.
<command>wdiff</command> — это интерфейс к <command>diff</command> из пакета GNU
diffutils. Это достаточно зрелая программа.  Его преемник, <command>wdiff2</command>,
является внешним интерфейсом к <command>mdiff</command> - таким же экспериментальным,
как и сам <command>mdiff</command>.  See <link linkend="Experimental">Experimental</link>.
</para>
<para>Слово считается объект заключенный между двумя пробелами.  Программа полезна
для сравнения двух текстов, в которых было изменено несколько слов и
добавлено нескольго абзацев.
</para>

<!-- - -->
<sect1 label="2.1" id="_0412_044b_0437_043e_0432-wdiff">
<title>Вызов <command>wdiff</command></title>

<para>Программы <command>wdiff</command> и <command>wdiff2</command> используют одинаковый набор
параметров командной строки. Они описаны ниже.  See <link linkend="wdiff-Compatibility">wdiff Compatibility</link>,
список различий.
</para>
<screen>wdiff <replaceable>option</replaceable> &#8230; <replaceable>old_file</replaceable> <replaceable>new_file</replaceable>
wdiff <replaceable>option</replaceable> &#8230; -d [<replaceable>diff_file</replaceable>]
</screen>
<para><command>wdiff</command> сравнивает файлы <replaceable>old_file</replaceable> и <replaceable>new_file</replaceable> и создает
копию <replaceable>new_file</replaceable> с комментариями на стандартном выходе.  Пустая строка
или &#8216;<literal>-</literal>&#8217; обозначает стандартный ввод, но стандартный ввод нельзя
использовать дважды в одном и том же вызове.  У файла должен быть указан
полный путь, имя каталога не принимается.  <command>wdiff</command> завершит работу
со статусом 0, если различий не обнаружено, статусом 1, если обнаружены
какие-либо различия, или статусом 2 в случае любой ошибки.
</para>
<para>В этой документации <firstterm>удаленный текст</firstterm> относится к тексту в
<replaceable>old_file</replaceable>, которого нет в <replaceable>new_file</replaceable>, а <firstterm>вставленный текст</firstterm>
относится к тексту в <replaceable>new_file</replaceable>, которого нет в <replaceable>old_file</replaceable>.
</para>
<para><command>wdiff</command> поддерживает следующие параметры командной строки:
</para>
<variablelist><varlistentry><term><option>--help</option>
</term><term><option>-h</option>
</term><listitem><para>Печать информауионное сообщение с описанием параметров.
</para>
</listitem></varlistentry><varlistentry><term><option>--version</option>
</term><term><option>-v</option>
</term><listitem><para>Печать номера версии <command>wdiff</command> в стандартном выводе ошибок.
</para>
</listitem></varlistentry><varlistentry><term><option>--no-deleted</option>
</term><term><option>-1</option>
</term><listitem><para>Подавление печати удаленных слов на выходе.  Если не выбран ни <option>-1</option>,
ни <option>-2</option>, для некоторых строк может получиться переполнение по длине
строки.
</para>
</listitem></varlistentry><varlistentry><term><option>--no-inserted</option>
</term><term><option>-2</option>
</term><listitem><para>Подавление печати вставленных слов на выходе.  Когда указан этот флаг,
пробелы в выводе берутся из <replaceable>old_file</replaceable> вместо <replaceable>new_file</replaceable>.  Если не
выбран ни <option>-1</option>, ни <option>-2</option>, для некоторых строк может получиться
переполнение по длине строки.
</para>
</listitem></varlistentry><varlistentry><term><option>--no-common</option>
</term><term><option>-3</option>
</term><listitem><para>Подавление печати общих слов на выходе.  Когда эта опция не выбрана, общие
слова и пробелы берутся из <replaceable>new_file</replaceable>, если не задана опция <option>-2</option>,
в противном случае общие слова и пробелы скорее берутся из <replaceable>old_file</replaceable>.
При выборе различия отделяются друг от друга строками с тире.  Кроме того,
если эта опция выбрана одновременно с <option>-1</option> или <option>-2</option>, то ни в
одном выводе не будет выделения, т. е. жирного или подчеркнутого.  Наконец,
если эта опция не выбрана, но выбраны обе опции <option>-1</option> и <option>-2</option>,
разделы общих слов между различиями разделяются строками с тире.
</para>
</listitem></varlistentry><varlistentry><term><option>--ignore-case</option>
</term><term><option>-i</option>
</term><listitem><para>Не учитывать разницу в регистре при сравнении слов.  При сравнении слов
каждая строчная буква эквивалентна букве в верхнем регистре.
</para>
</listitem></varlistentry><varlistentry><term><option>--statistics</option>
</term><term><option>-s</option>
</term><listitem><para>По завершении для каждого файла выводится общее количество слов, количество
общих, удаленных (вставленных) и измененных слов.  (Измененное слово — это
слово, которое было заменено или является частью замены.) За исключением
общего количества слов, за всеми числами следует процентное соотношение к
общему количеству слов в файле.
</para>
</listitem></varlistentry><varlistentry><term><option>--auto-pager</option>
</term><term><option>-a</option>
</term><listitem><para>Некоторые параметры, которые ранее использовались в предыдущих версиях
<command>wdiff</command> автоматически, теперь контролируются этим параметром.  При
использовании параметра пейджер вставляется всякий раз, когда вывод
<command>wdiff</command> направляется на пользовательский терминал.  Без этой опции
пейджер вызываться не будет и пользователь несет ответственность за явную
передачу вывода <command>wdiff</command> в пейджер (если это необходимо).
</para>
<para>Пейджер выбирается по значению переменной окружения <replaceable>PAGER</replaceable> при запуске
<command>wdiff</command>.  Если переменная <replaceable>PAGER</replaceable> не определена, то будет
использоваться пейджер по умолчанию, выбранный во время установки.
Определенное, но пустое значение <replaceable>PAGER</replaceable> означает отсутствие пейджера.
</para>
<para>При использовании этой опции, также выбирается одна из опций <option>-l</option> или
<option>-t</option>, в зависимости от того, присутствует ли строка &#8216;<literal>less</literal>&#8217; в
имени пейджера или нет.
</para>
<para>Часто полезно определить &#8216;<literal>wdiff</literal>&#8217; как псевдоним(alias) для &#8216;<literal>wdiff
-a</literal>&#8217;.  Однако это <emphasis>скрывает</emphasis> обычное поведение <command>wdiff</command>.
Поведение по умолчанию можно восстановить, просто передав выходные данные от
<command>wdiff</command> через <command>cat</command>.  Это отделяет вывод от
пользовательского терминала.
</para>
</listitem></varlistentry><varlistentry><term><option>--printer</option>
</term><term><option>-p</option>
</term><listitem><para>Использовать чрезмерное выделение.  Каждый символ удаленного текста
подчеркивается путем написания сначала символа подчеркивания &#8216;<literal>_</literal>&#8217;, затем
символа возврата, а затем буквы, которую нужно подчеркнуть.  Каждый символ
вставленного текста выделяется двукратным написанием с пробелом между ними.
Этот параметр не используется по умолчанию.
</para>
</listitem></varlistentry><varlistentry><term><option>--less-mode</option>
</term><term><option>-l</option>
</term><listitem><para>Использовать чрезмерное выделение.  Эта опция работает как опция
<option>-p</option>, но также перечеркивает пробелы, связанные со вставленным
текстом.  <command>less</command> показывает такие пробелы, используя обратное
видео.  Этот параметр не используется по умолчанию.  Однако он автоматически
включается всякий раз, когда <command>wdiff</command> испоользуется пейджер
<command>less</command>.  См. вариант <option>-a</option>.
</para>
<para>Этот параметр обычно используется в сочетании с <command>less</command>:
</para>
<screen>wdiff -l <replaceable>old_file</replaceable> <replaceable>new_file</replaceable> | less
</screen>
</listitem></varlistentry><varlistentry><term><option>--terminal</option>
</term><term><option>-t</option>
</term><listitem><para>Принудительное создание строк <literal>termcap</literal> для выделения частей вывода,
даже если стандартный вывод не связан с терминалом.  Переменная среды
<envar>TERM</envar> должна содержать имя правильной записи <literal>termcap</literal>.  Если
позволяет описание терминала, для выделения удаленного текста используется
подчеркивание, а для выделения вставленного текста используется жирный шрифт
или перевернутое видео.  Этот параметр не используется по умолчанию.  Однако
он автоматически включается всякий раз, когда <command>wdiff</command> используется
пейджер, и известно, что этот пейджер <emphasis>не</emphasis> <command>less</command>.  См. вариант
<option>-a</option>.
</para>
<para>Этот параметр обычно используется, когда вывод <command>wdiff</command> не
перенаправляется, а отправляется непосредственно на пользовательский
терминал, например:
</para>
<screen>wdiff -t <replaceable>old_file</replaceable> <replaceable>new_file</replaceable>
</screen>
<para>Обычно <command>wdiff</command> используется вместе с пейджером <command>more</command>,
например:
</para>
<screen>wdiff -t <replaceable>old_file</replaceable> <replaceable>new_file</replaceable> | more
</screen>
<para>Однако некоторые версии <command>more</command> используют выделение <literal>termcap</literal> в
своих целях, поэтому возможно странное поведение.
</para>
</listitem></varlistentry><varlistentry><term><option>--start-delete <replaceable>argument</replaceable></option>
</term><term><option>-w <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>argument</replaceable> в качестве <firstterm>маркера начала удаленного
текста</firstterm>.  Эта строка будет выводиться перед любой последовательностью
удаленного текста для указания его начала.  По умолчанию этот маркер не
используется, если нет других средств выделения начала такого текста; в этом
случае маркером по умолчанию является &#8216;<literal>[-</literal>&#8217;.
</para>
</listitem></varlistentry><varlistentry><term><option>--end-delete <replaceable>argument</replaceable></option>
</term><term><option>-x <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>argument</replaceable> в качестве <firstterm>маркера окончания удаленного
текста</firstterm>.  Эта строка будет выводиться после любой последовательности
удаленного текста для указания его окончания.  По умолчанию этот маркер не
используется, если нет других средств выделения окончания такого текста; в
этом случае маркером по умолчанию является <option>-]</option>.
</para>
</listitem></varlistentry><varlistentry><term><option>--start-insert <replaceable>argument</replaceable></option>
</term><term><option>-y <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>аргумент</replaceable> в качестве <firstterm>маркера начала вставки</firstterm>.  Эта
строка будет выводиться перед любой последовательностью вставленного текста
для указания ее начала.  По умолчанию этот не используется, если нет других
средств выделения начала такого текста; в этом случае маркером по умолчанию
является &#8216;<literal>{+</literal>&#8217;.
</para>
</listitem></varlistentry><varlistentry><term><option>--end-insert <replaceable>argument</replaceable></option>
</term><term><option>-z <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>аргумент</replaceable> в качестве <firstterm>маркера конца вставки</firstterm>.  Эта
строка будет выводиться после любой последовательности вставленного текста,
чтобы указания ее окончания.  По умолчанию этот маркер не используется, если
нет других выделения такого текста; в этом случае маркером по умолчанию
является &#8216;<literal>+}</literal>&#8217;.
</para>
</listitem></varlistentry><varlistentry><term><option>--avoid-wraps</option>
</term><term><option>-n</option>
</term><listitem><para>Подавление растяжения строки при отображении удаленного или вставленного
текста.  Любой отдельный фрагмент удаленного или вставленного текста,
занимающий много строк, будет считаться состоящим из множества более мелких
фрагментов, не содержащих новой строки.  Таким образом, удаленный текст,
например, будет иметь маркер окончания удаления в конце каждой строки,
непосредственно перед перносом строки, и маркер начала удаления в начале
следующей строки.  В длинном абзаце вставленного текста каждая строка будет
заключена в квадратные скобки между маркерами начала и конца вставки.  Это
поведение не используется по умолчанию.
</para>
</listitem></varlistentry><varlistentry><term><option>--diff-input</option>
</term><term><option>-d</option>
</term><listitem><para>Использование единый унифицированный diff в качестве входных данных. Если
входной файл не указан, вместо него используется стандартный ввод. Что можно
использовать для постобработки различий, сгенерированных другими
приложениями, такими как системы контроля версий:
</para>
<screen>svn diff | wdiff -d
</screen></listitem></varlistentry></variablelist>
<para>Обратите внимание, что опции <option>-p</option>, <option>-t</option> и <option>-[wxyz]</option> не
являются взаимоисключающими.  При использовании их комбинации вы получаете
совместный результат.  Опция <option>-l</option> является вариантом опции
<option>-p</option>.
</para>
<!-- - -->
</sect1>
<sect1 label="2.2" id="_041f_0440_0438_043c_0435_0440_044b-_0432_044b_0437_043e_0432_0430-wdiff">
<title>Реальные примеры вызова <command>wdiff</command></title>

<para>В этом разделе представлено несколько примеров использования, большинство из
них предоставлено пользователями <command>wdiff</command>.
</para>
<itemizedlist><listitem><para>Пример Change bars.
</para>
<itemizedlist>
<listitem><para>Этот пример взят из обсуждения с <ulink url="mailto:jbw@cs.bu.edu">Джо Уэллсом</ulink>.
</para>
<para>Следующая команда создает копию <replaceable>new_file</replaceable>, сдвинутую вправо на один
пробел для размещения change bars с момента последней редакции, игнорируя
изменения, возникшие только в результате добавления абзаца.  Любая строка с
новым или измененным текстом получит &#8216;<literal>|</literal>&#8217; в столбце 1.  Однако удаленный
текст не отображается и не помечается.
</para>
<screen>wdiff -1n <replaceable>old_file</replaceable> <replaceable>new_file</replaceable> |
  sed -e 's/^/  /;/{+/s/^ /|/;s/{+//g;s/+}//g'
</screen>
<para>Вот как это работает.  Находятся различия в словах, обращая внимание только
на дополнения, как того требует опция <option>-1</option>.  Для больших изменений,
которые охватывают границы строки, строки вставки скобок повторяются в
каждой выходной строке, как того требует опция <option>-n</option>.  Затем этот
вывод переформатируется с помощью скрипта <command>sed</command>, который сдвигает
текст на два столбца вправо, превращает начальный пробел в полосу только в
том случае, если в этой строке есть какой-то новый текст, а затем удаляет
все вставки квадратных скобок.
</para>
</listitem></itemizedlist>
</listitem><listitem><para>Пример La&tex;.
</para>
<itemizedlist><listitem>
<para>Этот пример предоставлен <ulink url="mailto:fisk@polar.bowdoin.edu">Steve Fisk</ulink>.
</para>
<para>Вызов La&tex; для помещения удаленного текста в блоки и нового текста в
двойные блоки:
</para>
<screen>wdiff -w &quot;\fbox{&quot; -x &quot;}&quot; -y &quot;\fbox{\fbox{&quot; -z &quot;}}&quot; &#8230;
</screen>
<para>работает хорошо.
</para>
</listitem></itemizedlist>
</listitem><listitem><para>Пример <command>troff</command>.
</para>
<itemizedlist>
<listitem><para>Предоставлен <ulink url="mailto:pgf@cayman.com">Пол Фокс</ulink>.
</para>
<para>Использование <command>wdiff</command> с некоторыми специфичными для <command>troff</command>
разделителями дает <emphasis>намного</emphasis> лучший результат.  Разделители, которые я
использовал:
</para>
<screen>wdiff -w'\s-5' -x'\s0' -y'\fB' -z'\fP' &#8230;
</screen>
<para>Это делает размер удалений на 5 пунктов меньше, чем обычно, и выделяет
полужирным вставки.  Фантастика!
</para>
<para>Я экспериментировал с:
</para>
<screen>wdiff -w'\fI' -x'\fP' -y'\fB' -z'\fP'
</screen>
<para>поскольку это больше похоже на значения по умолчанию, которые используются
для терминалов или принтеров, но поскольку я сам использую курсив для
выделения в своих документах, я подумал, что размер шрифта делает это был
более понятным.
</para>
<para>Я попробовал это с кодом и команда работаетработает на удивление хорошо...
</para>
</listitem><listitem><para><ulink url="mailto:leisner@eso.mc.xerox.com">Марти Лейснер</ulink> говорит:
</para>
<para>В предыдущем примере у вас был удален меньший текст и вставлен жирный
шрифт.  У меня был удаленный текст имеет меньший размер, а вставленны более
крупный - я использую жирный шрифт для других вещей - это более понятно.
</para>
<screen>wdiff -w '\s-3' -x'\s0' -y'\s+3' -z'\s0'
</screen>
</listitem></itemizedlist>
</listitem><listitem><para>Пример цветного вывода.
</para>
<itemizedlist>
<listitem><para>Этот пример взят из <ulink url="mailto:Martin.vGagern@gmx.net">Мартин фон Гагерн</ulink>.
</para>
<para>Если вам нравится цветной вывод, и ваш терминал поддерживает управляющие
последовательности ANSI, вы можете использовать этот вызов:
</para>
<screen>wdiff -n \
  -w $'\033[30;41m' -x $'\033[0m' \
  -y $'\033[30;42m' -z $'\033[0m' \
  &#8230; | less -R
</screen>
<para>При этом удаленный текст будет напечатан черным на красном, а вставленный
текст черным на зеленом, при условии, что ваши обычные цвета терминала —
белый на черном.  Конечно, вы можете выбрать какие хотите цвета.
</para>
<para>Нотация &#8216;<literal>$'&#8230;'</literal>&#8217; поддерживается GNU bash и, возможно, другими
оболочками. Если ваша оболочка не совместима, то могут понадобиться
дополнительные приемы для создания этих escape-последовательностей в
качестве аргументов командной строки.
</para>
</listitem></itemizedlist>
</listitem></itemizedlist>
<para>Кстати, пользователи GNU Emacs могут заметить, что интерактивная функция
<literal>compare-windows</literal> игнорирует изменения пробелов, если ей задан числовой
аргумент.  Если переменная <literal>compare-ignore-case</literal> не является
<literal>nil</literal>, она также игнорирует различия в регистре.  Таким образом, это
своего рода инкрементная версия <command>wdiff</command>.
</para>

<!-- ============================================================= -->
</sect1>
</chapter>
<chapter label="3" id="mdiff">
<title>Средство поиска multi-различий</title>
<!-- ============================================================= -->

<para>Название <command>mdiff</command> расшифровывается как <emphasis>multi-</emphasis><command>diff</command> и
предназначено для охвата функциональных возможностей некоторых других
программ типа <command>diff</command>.  Префикс <emphasis>multi-</emphasis> также обозначает тот
факт, что программа часто может получать на вход более файлов одновременно.
</para>
<para>Теория работы проста.  Программа разбивает все входные файлы на
последовательность элементов, которые могут быть строками или словами.
После говорят о том, что <command>mdiff</command> работает либо в <firstterm>режиме строк</firstterm>,
либо в <firstterm>режиме слов</firstterm>.  Затем он пытается найти последовательности
элементов, которые повторяются во входных файлах.  Такие общие
последовательности называются <firstterm>кластерами</firstterm> элементов, а каждое
повторение называется <firstterm>членом</firstterm> кластера.  После концептуального удаления
всех элементов кластера из всех входных файлов остается набор
<firstterm>различий</firstterm>.  Роль <command>mdiff</command> заключается в удобном перечислении
членов кластера и различий.
</para>
<para>Когда входные файлы очень похожи, вполне вероятно, что кластеры будут
охватывать множество элементов (строк или слов), а различия будут
небольшими.  Таким образом, большинство опций запрещают печать элементов
кластера.  Тем не менее, можно попросить, чтобы несколько начальных или
конечных элементов элементов кластера были напечатаны, для обеспечения
обратной связи или <firstterm>контекста</firstterm> различия, иногда говорят, что эти
элементы контекста находятся в <firstterm>горизонте</firstterm> различий.  В объединенных
листингах элементы кластера могут просто не печататься, за исключением
нескольких элементов контекста в начале члена (сразу после различия) и
нескольких элементов контекста в конце члена (непосредственно перед
различием).
</para>
<para>Когда члены кластера короткие или, если хотите, когда различия находятся
близко друг к другу, вполне возможно, что требуемые элементы контекста часто
охватывают полный объем членов кластера, которые затем больше не
подавляются, когда это происходит.  Ряд различий, смешанных с такими
непогашенными членами, называется <firstterm>куском</firstterm> (hunk).  Некоторые отчеты,
созданные <command>mdiff</command>, показаны в виде списка кусков, и следует
понимать, что общие элементы между фрагментами опущены.  Однако каждый кусок
сам по себе не имеет пропущенных элементов, а каждый элемент куска
анализируется как относящийся либо только к одному входному файлу, либо ко
многим из них.  Каждому куску предшествует заголовок, который объясняет
позицию строки всех входных файлов до самого куска.  Сравнивая заголовок
куска с предыдущим заголовком куска, пользователь может получить подсказку о
том, сколько текста не было напечатано.
</para>
<para>Когда два входных файла очень похожи, кластеры обычно представлены в одном и
том же порядке во всех файлах.  Если член кластера <replaceable>A</replaceable> в первом файле
соответствует члену кластера <replaceable>A</replaceable> во втором файле, вполне вероятно, что
другой член кластера <replaceable>B</replaceable> идущий <emphasis>после</emphasis> <replaceable> A</replaceable> в первом файле
будет соответствовать члену кластера <replaceable>B</replaceable> во втором файле, который также
появляется <emphasis>после</emphasis> <replaceable>A</replaceable>.  Таким образом, во многих случаях при
создании объединенного списка файлов члены кластера могут естественным
образом соответствовать друг другу.  Однако это не всегда верно, в
частности, когда второй файл был создан из первого путем перемещения
большого фрагмента кода из первоначального положения.  В таких случаях мы
говорим, что у членов есть <firstterm>пересечение</firstterm>.  Когда члены пересекаются и
<command>mdiff</command> должна составить объединенный список, она выбирает один
элемент кластера как <emphasis>естественно</emphasis> связанный с его корреспондентом
(либо парой <replaceable>A</replaceable>, либо парой <replaceable>B</replaceable>), а затем рассматривать другой
кластер как часть различия.  Перекрестный характер члена все еще может быть
проанализирован, а затем выведен в отчет или проигнорирован.
</para>
<para>Стандартная программа <command>diff</command> предназначена для случаев, когда
имеется ровно два входных файла, для которых пересекающиеся элементы следует
игнорировать.  Формат вывода <command>mdiff</command> был разработан таким образом,
что он должен напоминать вывод <command>diff</command> именно для этого случая.
Однако форматов <command>diff</command> недостаточно для представления всех случаев,
которые <command>mdiff</command> может решить, и они еще не отработаны.  Вот почему
<command>mdiff</command> в своем текущем состоянии все еще экспериментирует с
форматами вывода, которые могут быть изменены.
</para>
<para>Когда входные файлы не очень похожи или, скорее, отличаются, объединенные
списки не очень важны и полезны, и даже могут быть довольно запутанными.
Лучше всего в таких случаях использовать <command>mdiff</command> для создания
аннотированного повторного списка всех входных файлов, в котором элементы
кластера должным образом идентифицируются и ссылаются друг на друга.
</para>
<para>Статистика.
</para>
<screen>Read summary: 137 files, 41975 lines
Work summary: 439 clusters, 1608 members, 8837 duplicate lines
</screen>
<para>Сводные строки, вызванные опцией <option>-s</option>, говорят, что около 8837
неигнорируемых строк могут быть удалены из 41975, которые были прочитаны, с
помощью функций <literal>#include</literal>, <literal>#define </literal> или аналогичные устройств.
</para>
<para>Если кому-то удастся выполнить <command>mdiff</command> в GNU Emacs, чтобы описанный
выше вывод был собран в буфер <literal>*compilation*</literal>, команда <userinput>C-`</userinput>
(&#8216;<literal>M-x next- error<!-- /@w --></literal>&#8217;) перейдет к следующему элементу кластера в
другом окне и аналогично для других команд режима компиляции.  Это удобный
способ обработки вывода <command>mdiff</command>.
</para>
<para>Каждая строка в куске после заголовка идет из сравниваемых файлов, но
сдвинута вправо, поэтому первый столбец (или первые несколько столбцов)
каждой строки дает информацию о том, откуда идет строка.  Пробел указывает
на строку, общую для всех файлов.  В случае, если входных файлов всего два,
знак минус указывает на строку из первого файла, а знак плюс — на строку из
второго файла.  В противном случае буква от &#8216;<literal>a</literal>&#8217; до &#8216;<literal>z</literal>&#8217; или более
одной буквы, если имеется более 26 файлов, показывает, к какому файлу
относится строка.  Если строка или блок строк относятся ко многим файлам, но
не ко всем, в первом столбце отображается вертикальная черта, а строка или
блок строк заключаются в квадратные скобки между &#8216;<literal>@/</literal>&#8217; и &#8216;<literal>@. \\</literal>&#8217;
строк, которые являются своего рода комментариями внутри фрагмента.  В
начальной скобке перечислены все буквы файлов, относящиеся к входящей
строке.
</para>
<para>Первоначально я написал <command>mdiff</command> специально, чтобы помочь очистить
проект C++, который был настолько большим, и в котором много больших
монолитные классы были получены друг из друга, скорее всего, путем грубого
копирования с последующими локальными модификациями.  Я намеревался
фрагментировать наиболее распространенные кластеры и разделить части на
виртуальные методы во внешних классах и, при необходимости, переопределить
эти методы менее распространенными вариантами во внутренних классах.
<command>mdiff</command> хорошо указал мне места поиска.  Конечно, эту работу не
сделали за меня, но этот инструмент помогал в исследовании того, что следует
делать.  Повторное использование <command>mdiff</command> над наполовину очищенным
проектом дало мне более детальный анализ того, что осталось рассмотреть.
</para>

<!-- - -->
<sect1 label="3.1" id="_0412_044b_0437_043e_0432-mdiff">
<title>Вызов <command>mdiff</command></title>

<para>Формат запуска программы <command>mdiff</command>:
</para>
<screen>mdiff <replaceable>option</replaceable> &#8230; <replaceable>file</replaceable> &#8230;
</screen>
<para><command>mdiff</command> читает все входные <replaceable>file</replaceable> и выводит результаты на
стандартный вывод.  При желании стандартный поток ошибок может
использоваться для получения отчета о ходе выполнения или статистики.
</para>
<para><command>wdiff</command> сравнивает файлы <replaceable>old_file</replaceable> и <replaceable>new_file</replaceable> и создает
копию <replaceable>new_file</replaceable> с комментариями на стандартном выходе.  Пустая строка
или <option>-</option> обозначает стандартный ввод, но стандартный ввод нельзя
использовать дважды в одном и том же вызове.  У файла должен быть указан
полный путь, имя каталога не принимается.  <command>wdiff</command> завершит работу
со статусом 0, если различий не обнаружено, статусом 1, если обнаружены
какие-либо различия, или статусом 2 в случае любой ошибки.
</para>
<para>В этой документации <firstterm>удаленный текст</firstterm> относится к тексту в
<replaceable>old_file</replaceable>, которого нет в <replaceable>new_file</replaceable>, а <firstterm>вставленный текст</firstterm>
относится к тексту в <replaceable>new_file</replaceable>, которого нет в <replaceable>old_file</replaceable>.
</para>
<para><command>mdiff</command> поддерживает следующие параметры командной строки:
</para>
<variablelist><varlistentry><term><option>--version</option>
</term><listitem><para>Просто выводит номера версий на стандартный вывод и завершает работу, ничего
больше не делая.
</para>
</listitem></varlistentry><varlistentry><term><option>--help</option>
</term><listitem><para>Просто печатает страницу справки на стандартный вывод и завершает работу,
ничего больше не делая.
</para>
</listitem></varlistentry><varlistentry><term><option>--no-deleted</option>
</term><term><option>-1</option>
</term><listitem><para>Подавление печати удаленных слов на выходе.  Если не выбран ни <option>-1</option>,
ни <option>-2</option>, для некоторых строк может получиться переполнение по длине
строки.
</para>
</listitem></varlistentry><varlistentry><term><option>--no-inserted</option>
</term><term><option>-2</option>
</term><listitem><para>Подавление печати вставленных слов на выходе.  Когда указан этот флаг,
пробелы в выводе берутся из <replaceable>old_file</replaceable> вместо <replaceable>new_file</replaceable>.  Если не
выбран ни <option>-1</option>, ни <option>-2</option>, для некоторых строк может получиться
переполнение по длине строки.
</para>
</listitem></varlistentry><varlistentry><term><option>--no-common</option>
</term><term><option>-3</option>
</term><listitem><para>Подавление печати общих слов на выходе.  Когда эта опция не выбрана, общие
слова и пробелы берутся из <replaceable>new_file</replaceable>, если не задана опция <option>-2</option>,
в противном случае общие слова и пробелы скорее берутся из <replaceable>old_file</replaceable>.
При выборе различия отделяются друг от друга строками с тире.  Кроме того,
если эта опция выбрана одновременно с <option>-1</option> или <option>-2</option>, то ни в
одном выводе не будет выделения, т. е. жирного или подчеркнутого.  Наконец,
если эта опция не выбрана, но выбраны обе опции <option>-1</option> и <option>-2</option>,
разделы общих слов между различиями разделяются строками с тире.
</para>
</listitem></varlistentry><varlistentry><term><option>--ignore-case</option>
</term><term><option>-i</option>
</term><listitem><para>Не учитывать разницу в регистре при сравнении слов.  При сравнении слов
каждая строчная буква эквивалентна букве в верхнем регистре.
</para>
</listitem></varlistentry><varlistentry><term><option>--auto-pager</option>
</term><term><option>-A</option>
</term><listitem><para>Некоторые параметры, которые ранее использовались в предыдущих версиях
<command>wdiff</command> автоматически, теперь контролируются этим параметром.  При
использовании параметра пейджер вставляется всякий раз, когда вывод
<command>wdiff</command> направляется на пользовательский терминал.  Без этой опции
пейджер вызываться не будет и пользователь несет ответственность за явную
передачу вывода <command>wdiff</command> в пейджер (если это необходимо).
</para>
<para>Пейджер выбирается по значению переменной окружения <replaceable>PAGER</replaceable> при запуске
<command>wdiff</command>.  Если переменная <replaceable>PAGER</replaceable> не определена, то будет
использоваться пейджер по умолчанию, выбранный во время установки.
Определенное, но пустое значение <replaceable>PAGER</replaceable> означает отсутствие пейджера.
</para>
<para>При использовании этой опции, также выбирается одна из опций <option>-l</option> или
<option>-t</option>, в зависимости от того, присутствует ли строка &#8216;<literal>less</literal>&#8217; в
имени пейджера или нет.
</para>
<para>Часто полезно определить &#8216;<literal>wdiff</literal>&#8217; как псевдоним(alias) для &#8216;<literal>wdiff
-a</literal>&#8217;.  Однако это <emphasis>скрывает</emphasis> обычное поведение <command>wdiff</command>.
Поведение по умолчанию можно восстановить, просто передав выходные данные от
<command>wdiff</command> через <command>cat</command>.  Это отделяет вывод от
пользовательского терминала.
</para>
</listitem></varlistentry><varlistentry><term><option>--printer</option>
</term><term><option>-p</option>
</term><listitem><para>Использовать чрезмерное выделение.  Каждый символ удаленного текста
подчеркивается путем написания сначала символа подчеркивания &#8216;<literal>_</literal>&#8217;, затем
символа возврата, а затем буквы, которую нужно подчеркнуть.  Каждый символ
вставленного текста выделяется двукратным написанием с пробелом между ними.
Этот параметр не используется по умолчанию.
</para>
</listitem></varlistentry><varlistentry><term><option>--less-mode</option>
</term><term><option>-l</option>
</term><listitem><para>Использовать чрезмерное выделение.  Эта опция работает как опция
<option>-p</option>, но также перечеркивает пробелы, связанные со вставленным
текстом.  <command>less</command> показывает такие пробелы, используя обратное
видео.  Этот параметр не используется по умолчанию.  Однако он автоматически
включается всякий раз, когда <command>wdiff</command> испоользуется пейджер
<command>less</command>.  См. вариант <option>-a</option>.
</para>
<para>Этот параметр обычно используется в сочетании с <command>less</command>:
</para>
<screen>wdiff -l <replaceable>old_file</replaceable> <replaceable>new_file</replaceable> | less
</screen>
</listitem></varlistentry><varlistentry><term><option>--terminal</option>
</term><term><option>-t</option>
</term><listitem><para>Принудительное создание строк <literal>termcap</literal> для выделения частей вывода,
даже если стандартный вывод не связан с терминалом.  Переменная среды
&#8216;<literal>TERM</literal>&#8217; должна содержать имя допустимой записи <literal>termcap</literal>.  Если
позволяет описание терминала, для выделения удаленного текста используется
подчеркивание, а для выделения вставленного текста используется жирный шрифт
или перевернутое видео.  Этот параметр не используется по умолчанию.  Однако
он автоматически включается всякий раз, когда <command>wdiff</command> используется
пейджер, и известно, что этот пейджер <emphasis>не</emphasis> <command>less</command>.  См. вариант
<option>-a</option>.
</para>
<para>Этот параметр обычно используется, когда вывод <command>wdiff</command> не
перенаправляется, а отправляется непосредственно на пользовательский
терминал, например:
</para>
<screen>wdiff -t <replaceable>old_file</replaceable> <replaceable>new_file</replaceable>
</screen>
<para>Обычно <command>wdiff</command> используется вместе с пейджером <command>more</command>,
например:
</para>
<screen>wdiff -t <replaceable>old_file</replaceable> <replaceable>new_file</replaceable> | more
</screen>
<para>Однако некоторые версии <command>more</command> используют выделение <literal>termcap</literal> в
своих целях, поэтому возможно странное поведение.
</para>
</listitem></varlistentry><varlistentry><term><option>--start-delete <replaceable>argument</replaceable></option>
</term><term><option>-w <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>argument</replaceable> в качестве <firstterm>маркера начала удаленного
текста</firstterm>.  Эта строка будет выводиться перед любой последовательностью
удаленного текста для указания его начала.  По умолчанию этот маркер не
используется, если нет других средств выделения начала такого текста; в этом
случае маркером по умолчанию является &#8216;<literal>[-</literal>&#8217;.
</para>
</listitem></varlistentry><varlistentry><term><option>--end-delete <replaceable>argument</replaceable></option>
</term><term><option>-x <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>argument</replaceable> в качестве <firstterm>маркера окончания удаленного
текста</firstterm>.  Эта строка будет выводиться после любой последовательности
удаленного текста для указания его окончания.  По умолчанию этот маркер не
используется, если нет других средств выделения окончания такого текста; в
этом случае маркером по умолчанию является <option>-]</option>.
</para>
</listitem></varlistentry><varlistentry><term><option>--start-insert <replaceable>argument</replaceable></option>
</term><term><option>-y <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>аргумент</replaceable> в качестве <firstterm>маркера начала вставки</firstterm>.  Эта
строка будет выводиться перед любой последовательностью вставленного текста
для указания ее начала.  По умолчанию этот не используется, если нет других
средств выделения начала такого текста; в этом случае маркером по умолчанию
является &#8216;<literal>{+</literal>&#8217;.
</para>
</listitem></varlistentry><varlistentry><term><option>--end-insert <replaceable>argument</replaceable></option>
</term><term><option>-z <replaceable>argument</replaceable></option>
</term><listitem><para>Использование <replaceable>аргумент</replaceable> в качестве <firstterm>маркера конца вставки</firstterm>.  Эта
строка будет выводиться после любой последовательности вставленного текста,
чтобы указания ее окончания.  По умолчанию этот маркер не используется, если
нет других выделения такого текста; в этом случае маркером по умолчанию
является &#8216;<literal>+}</literal>&#8217;.
</para>
</listitem></varlistentry><varlistentry><term><option>--avoid-wraps</option>
</term><term><option>-n</option>
</term><listitem><para>Подавление растяжения строки при отображении удаленного или вставленного
текста.  Любой отдельный фрагмент удаленного или вставленного текста,
занимающий много строк, будет считаться состоящим из множества более мелких
фрагментов, не содержащих новой строки.  Таким образом, удаленный текст,
например, будет иметь маркер окончания удаления в конце каждой строки,
непосредственно перед перносом строки, и маркер начала удаления в начале
следующей строки.  В длинном абзаце вставленного текста каждая строка будет
заключена в квадратные скобки между маркерами начала и конца вставки.  Это
поведение не используется по умолчанию.
</para>
</listitem></varlistentry></variablelist>
<para>Некоторые опции встроены в программу, но вполне могут стать опциями в более
поздних версиях.  Например:
</para>
<itemizedlist><listitem><para>Ни один кластер не может охватывать границу файла, то есть начинаться в
конце одного входного файла и продолжаться в начале следующего файла.
</para>
</listitem><listitem><para>Кластер может иметь много членов из одного и того же файла.
</para>
</listitem><listitem><para>Пробел между началом строки и первым непробельным символом игнорируется.
</para>
</listitem><listitem><para>Пробелы имеют значение, если они находятся внутри строки или идут в конце
строки.
</para>
</listitem><listitem><para>Строки, не имеющие значимой части (пока только пробельные символы), являются
<firstterm>игнорируемыми</firstterm>.  Такие игнорируемые строки логически рассматриваются
как не являющиеся частью входных файлов для целей сравнения.
</para>
</listitem><listitem><para>Комментарии языка Си не особенно игнорируются.  Если они не игнорируются по
другим причинам (пробельные символы), они действительно являются важными
строками.
</para>
</listitem><listitem><para>Ни один член кластера не может напрямую начинаться или заканчиваться
игнорируемыми строками.  Однако игнорируемые строки все же могут быть
встроены в член кластера.
</para>
</listitem><listitem><para>В сгенерированном выводе кластеры, содержащие наибольшее количество
игнорируемых строк, выводятся первыми, а меньшие кластеры отображаются
последними.  Все строки, относящиеся к одному кластеру, выводятся вместе.
Внутри кластера члены перечислены в порядке начального чтения входных
файлов.
</para>
</listitem></itemizedlist>
<para>Обратите внимание, что опции <option>-p</option>, <option>-t</option> и <option>-[wxyz]</option> не
являются взаимоисключающими.  При использовании их комбинации вы получаете
совместный результат.  Опция <option>-l</option> является вариантом опции
<option>-p</option>.
</para>
<!-- - -->
</sect1>
<sect1 label="3.2" id="_042d_0444_0444_0435_043a_0442_0438_0432_043d_043e_0441_0442_044c">
<title>Соображения по ресурсам и эффективность</title>

<variablelist><varlistentry><term>Потребление памяти
</term><listitem>
<para><command>mdiff</command> легко справится с проектом среднего размера.  Для 32-битной
архитектуры требования к памяти могут быть рассчитаны следующим образом:
</para>
<itemizedlist><listitem><para>8 байт на файл
</para></listitem><listitem><para>8 байт на строку
</para></listitem><listitem><para>4 байта на кластер
</para></listitem><listitem><para>8 байт на член кластера
</para></listitem></itemizedlist>
</listitem></varlistentry><varlistentry><term>Потребление времени
</term><listitem>
<para>Чтобы оценить скорость, рассмотрим пример, показанный выше (see <link linkend="mdiff">mdiff</link>),
и получив следующую статистику:
</para>
<screen>Read summary: 137 files, 41975 lines
Work summary: 439 clusters, 1608 members &#8230;
</screen>
<para>После большого количества файлов в кеше памяти и перенаправления вывода в
<filename>/dev/null</filename> обработка занимает 3 секунды реального времени на Intel
486/100, что выглядит неплохо.  Я действительно боялся поведения какой-то
скрытой сложности O(<replaceable>n</replaceable>^2)<footnote><para><replaceable>n</replaceable> — это общее количество
строк.</para></footnote>, даже если программа в основном имеет сложность O(<replaceable>n</replaceable>*log
(<replaceable>n</replaceable>)).  Может быть, кто-нибудь обнаружит или сконструирует кейсы, чтобы
поставить <command>mdiff</command> на колени.  До сих пор <command>mdiff</command>, похоже,
хорошо справлялась с поставленными перед ней небольшими проблемами.  Если мы
придумаем и сгенерируем более традиционный вывод, похожий на <command>diff</command>,
в котором все входные файлы повторно перечисляются, это добавит времени
обработке, но оно будет линейно относительно общей длины входных файлов.
</para>
<para>Существует умный оптимизированный алгоритм сортировки <emphasis>всех</emphasis> подстрок
файла, который можно обобщить для обработки слов или строк для
<command>mdiff</command>.  Но поскольку программа работает быстрее, чем мы изначально
ожидали, нет необходимости прибегать к использованию такого алгоритма.
</para>
</listitem></varlistentry><varlistentry><term>Сложность торговли для ясности
</term><listitem>
<para>Когда строки часто повторяются, существует на удивление много способов
связать блоки строк, и сообщение о <emphasis>всех</emphasis> них может привести к очень
громоздким спискам.  Любой выбор сообщать о сходстве или нет, несколько
произволен, но мы должны дать возможность выбора, чтобы программа была
практичной.  Некоторые из этих вариантов подробно описаны.
</para>
<para>Если все члены данного кластера <replaceable>A</replaceable> являются подмножествами всех членов
другого данного кластера <replaceable>B</replaceable>, то кластер <replaceable>A</replaceable> полностью забыт.
Однако предположим, например, что в <replaceable>A</replaceable> больше членов, чем в <replaceable>B</replaceable>.
Тогда некоторые элементы <replaceable>A</replaceable> обязательно оказываются не связанными ни с
одним членом <replaceable>B</replaceable>.  В этом случае было решено, что полезнее сообщать обо
<emphasis>всех</emphasis> вхождениях членов <replaceable>A</replaceable>, даже о тех, которые встроены во
вхождения элементов <replaceable>B</replaceable>.  Если вас интересуют только члены <replaceable>B</replaceable>,
аннотации, относящиеся к <replaceable>A</replaceable>, могут восприниматься как мусор.  Однако,
если вы заинтересованы в членах <replaceable>A</replaceable>, получение их всех, вероятно,
является наиболее полезным выбором.
</para>
<para>Иногда случается, что члены одного и того же кластера пересекаются.  В
строке &#8216;<literal>a a a<!-- /@w --></literal>&#8217; есть два перекрывающихся элемента для кластера,
представленного строкой &#8216;<literal>a a<!-- /@w --></literal>&#8217;, один состоит из первых двух
&#8216;<literal>a</literal>&#8217;, другой - из последних двух &#8216;<literal>a</literal>&#8217;.  В этом случае один член
такого перекрытия автоматически обрезается, поэтому перекрытия не
происходит.
</para>
<para>Пробельные символы и элементы, содержащие только разделители, являются
возможным источником большой сложности, если они полностью воспринимаются
как важные.  Поскольку это не добавляет ясности, обычно их лучше
игнорировать с помощью <option>--ignore-blank-lines</option> (<option>-B</option>) или
<option>--ignore-delimiters</option> (<option>-j</option>).  Увеличение значения параметра
<option>--minimum-size=<replaceable>items</replaceable></option> (&#8216;<literal>-J <replaceable>items</replaceable><!-- /@w --></literal>&#8217;) также
усекает сложность в пользу ясности, но некоторые небольшие совпадения потом
могут остаться незамеченным.  Как именно лучше настроить значение
<replaceable>items</replaceable>, решает пользователь.
</para>
</listitem></varlistentry></variablelist>
<!-- ============================================================= -->
</sect1>
</chapter>
<chapter label="4" id="unify">
<title>Конвертер форматов diff</title>
<!-- ============================================================= -->

<para>Программа <command>unify</command> предназначена для управления различиями контекста
и различиями унифицированного контекста.  Команда <command>unify</command> будет
принимать в качестве входных данных либо обычные различия контекста (старого
или нового стиля), либо унифицированные различия контекстов, а в качестве
выходных данных будет генерировать унифицированные различия контекстов или
различия контекстов нового стиля.
</para>
<para>Другие параметры позволяют вам отображать не-diff (комментарии) строки в
stderr, изменять diff, удаляя строки комментариев, и/или настраивать diff в
формат, подходящий для выпуска исправлений.
</para>
<para>Я думаю, что большинство людей в целом предпочитают унифицированные различия
контекста.  Но у некоторых из нас просто проблемы с чтением unidiff, только
если они не становятся очень простыми.  Обычные сравнения контекста
показывают, каким был код <emphasis>до</emphasis>, а затем каким был код <emphasis>после</emphasis>.
Некоторые люди просто предпочитают дважды хорошо понять, чем один раз
нечетко.  Инструмент полезен для тех, кто обрабатывает множество различий из
разных источников и хочет, чтобы они были в едином формате.
</para>

<!-- - -->
<sect1 label="4.1" id="_0412_044b_0437_043e_0432-unify">
<title>Вызов <command>unify</command></title>

<para>Формат запуска программы <command>unify</command>:
</para>
<screen>unify <replaceable>option</replaceable> &#8230; [<replaceable>file</replaceable>]
</screen>
<para>Программа читает diff для преобразования из <replaceable>file</replaceable>, или, если исходный
файл не указан, он будет считан из стандартного ввода.  По умолчанию
различия выводятся в стиле, противоположном тому, что было введено, то есть
различия обычного контекста станут различиями единого контекста, а различия
единого контекста станут различиями единого контекста, что можно
переопределить с помощью параметров.
</para>
<para><command>unify</command> поддерживает следующие параметры командной строки:
</para>
<variablelist><varlistentry><term><option>--version</option>
</term><listitem><para>Просто выводит номера версий на стандартный вывод и завершает работу, ничего
больше не делая.
</para>
</listitem></varlistentry><varlistentry><term><option>--help</option>
</term><listitem><para>Просто печатает страницу справки на стандартный вывод и завершает работу,
ничего больше не делая.
</para>
</listitem></varlistentry><varlistentry><term><option>--context-diffs</option>
</term><term><option>-c</option>
</term><listitem><para>Принудительный вывод различий контекста.
</para>
</listitem></varlistentry><varlistentry><term><option>--echo-comments</option>
</term><term><option>-e</option>
</term><listitem><para>Отображает строки без различий (комментариев) в stderr.  Если строка
комментария удаляется с помощью параметра <option>-p</option>, она повторяется с
предшествующим &#8216;<literal>!!! </literal>&#8217;.  Если удаляются все комментарии (с помощью опции
<option>-s</option>), специального обозначения не дается.
</para>
</listitem></varlistentry><varlistentry><term><option>--old-diffs</option>
</term><term><option>-o</option>
</term><listitem><para>Используется для того, чтобы интерпретировать контекстное различие как
относящееся к старому стилю, даже если оно имеет дополнительные звездочки в
конце, которые обычно обозначают новый стиль.  Это необходимо только в том
случае, если <command>unify</command> не работает с вашей версией <command>diff</command>.
</para>
</listitem></varlistentry><varlistentry><term><option>--patch-format</option>
</term><term><option>-p</option>
</term><listitem><para>Включает режим патч-вывода.  Это делает две вещи:
</para>
<orderedlist numeration="arabic"><listitem><para>Преобразуйте заголовок, например:
</para>
<screen>*** orig/file	Sat May  5 02:59:37 1990
--- ./file	Sat May  5 03:00:08 1990
</screen>
<para>в строку &#8216;<literal>Index: file</literal>&#8217; &#8212; мы выбираем более короткое имя и удаляем
начальную последовательность &#8216;<literal>./</literal>&#8217;, если она присутствует.
</para>
</listitem><listitem><para>Строки, начинающиеся с &#8216;<literal>Только в <!-- /@w --></literal>&#8217;, &#8216;<literal>Общий подкаталог<!-- /@w --></literal>&#8217;,
&#8216;<literal>Двоичные файлы<!-- /@w --></literal>&#8217; или &#8216;<literal>diff -<!-- /@w --></literal>&#8217;.
</para>
</listitem></orderedlist>
</listitem></varlistentry><varlistentry><term><option>-P</option>
</term><listitem><para>То же, что и <option>-p</option>.
</para>
</listitem></varlistentry><varlistentry><term><option>--strip-comments</option>
</term><term><option>-s</option>
</term><listitem><para>Удаляет неразличимые строки (комментарии).
</para>
</listitem></varlistentry><varlistentry><term><option>--unidiffs</option>
</term><term><option>-u</option>
</term><listitem><para>Форсирует унифицированный вывод различий.
</para>
</listitem></varlistentry><varlistentry><term><option>-U</option>
</term><listitem><para>То же, что и <option>-up</option>.
</para>
</listitem></varlistentry><varlistentry><term><option>--use-equals</option>
</term><term><option>-=</option>
</term><listitem><para>Будет использовать префикс &#8216;<literal>=</literal>&#8217; в унифицированном diff для строк, общих
для обоих файлов, вместо использования начального пробела.  Хотя это труднее
читать, меньше вероятность того, что оно будет искажено сайтами с
отбрасыванием завершающего пробела при размещении в Usenet.
</para>
</listitem></varlistentry></variablelist>
<!-- ============================================================= -->
</sect1>
</chapter>
<chapter label="5" id="_0421_043e_0432_043c_0435_0441_0442_0438_043c_043e_0441_0442_044c">
<title>Чем отличается <command>mdiff</command></title>
<!-- ============================================================= -->

<para>В проекте GNU уже есть программа <command>diff</command>, которая является частью
пакета GNU diffutils.  Существуют также различные не относящиеся к GNU
программы <command>diff</command>, предоставляемые различными разработчиками.
</para>
<para>Существует также хорошо зарекомендовавшая себя <command>wdiff</command>, которая
использует <command>diff</command> под капотом. Она немного отличается от
<command>wdiff2</command>, предполагаемого преемника <command>mdiff</command>.
</para>
<para>В следующих разделах сравниваются спецификации <command>mdiff</command> как с
<command>diff</command> GNU, так и с <command>wdiff</command>.
</para>

<!-- - -->
<sect1 label="5.1" id="_0421_043e_0432_043c_0435_0441_0442_0438_043c_043e_0441_0442_044c-_0441-diff">
<title>Отличия от <command>diff</command></title>

<para>GNU <command>diff</command> — это программа, которая долгое время совершенствовалась
и для которой алгоритмы основаны на литературе по информатике.  Это быстрая
программа.  Для сравнения, <command>mdiff</command> — не более чем программа, которую
быстро забивают, чтобы удовлетворить несколько конкретных потребностей.  Она
только пытается не быть чрезмерно медленной.
</para>
<para>Большинство параметров <command>diff</command> принимается <command>mdiff</command> с одними и
теми же короткими и длинными именами параметров и может выдавать похожий
вывод, что упрощает изучение <command>mdiff</command> и делает ее менее неожиданным
для пользователей.  Тем не менее, существуют некоторые различия в
декодировании опций и формате вывода.  Поскольку <command>diff</command> и
<command>mdiff</command> используют разные алгоритмы сопоставления, весьма вероятно,
что различия будут проанализированы по разному.
</para>
<itemizedlist><listitem><para>Несколько параметров <command>diff</command>, которые либо не принимают аргументов,
либо требуют обязательного аргумента, реализованы в <command>mdiff</command> как
параметры, принимающие необязательный аргумент.  Это может привести к
некоторым неожиданностям, например, <option>-c4bir</option> будет принят
<command>diff</command> и отклонен <command>mdiff</command>, однако он может переписать
<option>-birc4</option> для обоих.  Рассмотрим это ниже.
</para>
</listitem><listitem><para>Опции <option>-c</option> и <option>-u</option> в <command>diff</command> запрашивают вывод обычного
контекста и унифицированного контекста, соответственно, без указания
количества строк в контексте.  <command>diff</command> имеет параметры &#8216;<literal>-C
<replaceable>number</replaceable><!-- /@w --></literal>&#8217; и &#8216;<literal>-U <replaceable>number</replaceable><!-- /@w --></literal>&#8217; для запроса различий обычного
или унифицированного контекста с <replaceable>number</replaceable> строк контекста.  Если
<option>-c4</option> запрашивает четыре строки контекста, &#8216;<literal>4</literal>&#8217; на самом деле не
является аргументом <option>-c</option>, и на самом деле это интерпретируется как
&#8216;<literal>-c -4<!-- /@w --> </literal>&#8217;, где <option>-<replaceable>number</replaceable></option> означает устаревшую опцию для
выбора количества строк контекста, которую <command>mdiff</command> не реализует.  В
<command>mdiff</command> <option>-c</option> и <option>-u</option> на самом деле являются двумя
опциями, которым разрешено получать необязательный аргумент, поэтому
количество строк может быть задано или не задано по выбору пользователя.  В
<command>mdiff</command> опции <option>-C</option> и <option>-U</option> полностью эквивалентны
<option>-c</option> и <option>-u</option> и предоставляются только для совместимости.
</para>
</listitem><listitem><para>Опция <option>-v</option> в <command>diff</command> означает <option>--version</option>, а
<option>--verbose</option> в <command>mdiff</command>.  Для <option>--version</option> в
<command>mdiff</command> нет сокращенной формы.
</para>
</listitem></itemizedlist>
<!-- - -->
</sect1>
<sect1 label="5.2" id="wdiff-Compatibility">
<title>Отличия от <command>wdiff</command></title>

<para>Даже если <command>mdiff</command> предназначен для полной поддержки <command>wdiff</command>,
параметры были перемешаны, поэтому <command>mdiff</command> может лучше объединить
параметры <command>diff</command> и <command>wdiff</command> в общую схему.  <command>diff</command>
привычки почти всегда отдавали предпочтение при реорганизации этой опции.
</para>
<para><command>wdiff2</command> теперь является простым внешним интерфейсом к
<command>mdiff</command>, который только переписывает параметры.  Применяются
следующие примечания.
</para>
<itemizedlist><listitem><para>Некоторые опции просто передаются без изменений, это <option>-1</option>,
<option>-2</option>, <option>-3</option> и <option>-i</option>.
</para>
</listitem><listitem><para>Параметр <option>-c</option> также превращается в <option>-i</option> для совместимости с
версиями <command>wdiff</command> вплоть до &#8216;<literal>0.4</literal>&#8217;.
</para>
</listitem><listitem><para>Простая опция <option>-a</option> в <command>wdiff</command> становится <option>-A</option> в
<command>mdiff</command>, <option>-l</option> становится <option>-k</option>, <option>-n</option> становится
<option>-m</option>, <option>-p</option> становится <option>-o</option>, <option>-s</option> становится
<option>-v</option>, а <option>-t</option> становится <option>-z</option>.
</para>
</listitem><listitem><para>Опции, представляющие строки, такие как <option>-w</option>, <option>-x</option>,
<option>-y</option> и <option>-z</option> в <command>wdiff</command>, соответственно становятся
<option>-Y</option>, <option>-Z</option>, <option>-Q</option> и <option>-R</option> в <command>mdiff</command>.
</para>
</listitem><listitem><para>Опции <option>-C</option>, <option>-h</option> и <option>-v</option> обрабатываются непосредственно
<command>wdiff</command> и не передаются <command>mdiff</command>.
</para>
</listitem><listitem><para>Кроме того, параметр <option>-C</option> для <command>wdiff</command> не имеет эквивалента в
<command>mdiff</command>.
</para>
</listitem><listitem><para>Новая опция <option>-q</option> блокирует сообщение, объясняющее, как
<command>mdiff</command> могла быть вызвана напрямую.
</para>
</listitem><listitem><para>Параметр <option>--diff-input</option> (<option>-d</option>) из <command>wdiff</command> не
поддерживается <command>wdiff2</command> (пока).
</para>
</listitem></itemizedlist>
<!-- end ifset EXPERIMENTAL -->

<!-- ============================================================= -->
</sect1>
</chapter>
<chapter label="6" id="Experimental">
<title>Экспериментальные программы</title>
<!-- ============================================================= -->

<para>Исходный пакет GNU wdiff содержит исходные коды ряда инструментов, помимо
самой команды <command>wdiff</command>.  Они считаются экспериментальными: они могут
сработать для вас, но с тем же успехом могут и провалиться.  Следующие
программы считаются экспериментальными:
</para>
<itemizedlist><listitem><para><command>mdiff</command>
</para></listitem><listitem><para><command>wdiff2</command>
</para></listitem><listitem><para><command>unify</command>
</para></listitem></itemizedlist>
<para>Сборку этих приложений можно включить передав <option>--with-experimental</option> в
скрипт <filename>configure</filename>.
</para>
<para><emphasis>Для этой сборки они были включены.</emphasis> Если вы столкнулись с ошибкой в
​​экспериментальной программе, сопровождающие все равно хотели бы узнать о
ней, но есть большая вероятность, что они решат не исправлять такие
проблемы, если вы не предоставите патч.
</para>

<!-- - -->
<sect1 label="6.1" id="_0418_0441_0442_043e_0440_0438_044f-_044d_043a_0441_043f_0435_0440_0438_043c_0435_043d_0442_0430_043b_044c_043d_044b_0445-_0438_043d_0441_0442_0440_0443_043c_0435_043d_0442_043e_0432">
<title>История экспериментальных программ</title>

<para>Многие пользователи предлагали функции, которые, в свою очередь, требовали
интеграции <command>wdiff</command> в GNU diffutils.  Сотрудничество оказалось
довольно сложным.  Через несколько лет автор <command>wdiff</command>, наконец,
сдался и создал <command>mdiff</command>, чтобы выйти из ситуации и получить
возможность выполнять предложения пользователей.
</para>
<para>Прежде чем <command>mdiff</command> и новая <command>wdiff2</command>, основанная на ней, были
официально выпущены, первоначальный автор отказался от поддержки.  У новых
сопровождающих было мало опыта работы с кодом, и поэтому они решили пометить
эти возможности как экспериментальные. Таким образом, код не был бы потерян,
но стало ясно, что он не так протестирован, как старая добрая команда
<literal>wdiff</literal>.
</para>

</sect1>
</chapter>
</book>
